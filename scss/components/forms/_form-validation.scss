// Form validation
//
// Our inline errors
.form-group {
  &.warn,
  &.errored {
    .warning,
    .error {
      position: absolute;
      z-index: 10;
      display: block; // Show up in errored/warn state
      max-width: 450px; // Keep our long errors readable
      padding: 5px 8px;
      margin: $spacer-1 0 0;
      font-size: 13px;
      font-weight: normal;
      border-style: solid;
      border-width: 1px;
      border-radius: 3px;

      &::after,
      &::before {
        position: absolute;
        bottom: 100%;
        left: 10px;
        z-index: 15;
        width: 0;
        height: 0;
        pointer-events: none;
        content: " ";
        border: solid transparent;
      }

      &::after {
        border-width: 5px;
      }

      &::before {
        margin-left: -1px;
        border-width: 6px;
      }
    }
  }

  &.warn {
    .warning {
      color: $yellow-900;
      background-color: $yellow-100;
      border-color: $border-yellow;

      &::after {
        border-bottom-color: $yellow-100;
      }

      &::before {
        border-bottom-color: $border-yellow;
      }
    }
  }

  &.errored {
    label {
      color: $text-red;
    }

    .error {
      color: $red-900;
      background-color: $bg-red-light;
      border-color: $border-red-light;

      &::after {
        border-bottom-color: $bg-red-light;
      }

      &::before {
        border-bottom-color: $border-red-light;
      }
    }
  }
}

//
// Variants
//
.form-group {
  &--required {
    dt label::after {
      padding-left: 5px;
      color: $text-red;
      content: "*";
    }
  }
}

//
// Form Elements
//
.form-group {
  dd {
    h4 {
      margin: 4px 0 0;

      &.is-error { color: $text-red; }

      &.is-success { color: $text-green; }

      + .note {
        margin-top: 0;
      }
    }
  }
}

.note {
  min-height: 17px;
  margin: 4px 0 2px;
  font-size: 12px;
  color: $text-gray;

  .spinner {
    margin-right: 3px;
    vertical-align: middle;
  }
}

// Input groups
.form-warning {
  padding: 8px 10px;
  margin: 10px 0;
  font-size: 14px;
  color: $yellow-900;
  background: $yellow-100;
  border: 1px solid $border-yellow;
  border-radius: 3px;

  p {
    margin: 0;
    line-height: 1.5;
  }

  a { font-weight: $font-weight-bold; }
}

// Form AJAX states
//
// Form fields that need feedback for AJAX loading, success
// states and errored states.
.form-group {
  .success,
  .error,
  .indicator {
    display: none;
    font-size: 12px;
    font-weight: $font-weight-bold;
  }

  &.loading {
    opacity: 0.5;

    .indicator {
      display: inline;
    }

    .spinner {
      display: inline-block;
      vertical-align: middle;
    }
  }

  &.successful {
    .success {
      display: inline;
      color: $text-green;
    }
  }
}


dl.form-group > dd {
  .form-control {
    &.is-autocheck-loading,
    &.is-autocheck-successful,
    &.is-autocheck-errored {
      padding-right: 30px; // Leave some space for our validation icons
    }

    &.is-autocheck-loading {
      background-image: url("/images/spinners/octocat-spinner-16px.gif");
    }

    &.is-autocheck-successful {
      background-image: url("/images/modules/ajax/success.png");
    }

    &.is-autocheck-errored {
      background-image: url("/images/modules/ajax/error.png");
    }
  }
}

// Retinization of form validation icons that aren't octicons yet
@include retina-media-query {
  dl.form-group > dd {
    .form-control {
      &.is-autocheck-loading,
      &.is-autocheck-successful,
      &.is-autocheck-errored {
        background-size: 16px 16px;
      }

      &.is-autocheck-loading {
        background-image: url("/images/spinners/octocat-spinner-32.gif");
      }

      &.is-autocheck-successful {
        background-image: url("/images/modules/ajax/success@2x.png");
      }

      &.is-autocheck-errored {
        background-image: url("/images/modules/ajax/error@2x.png");
      }
    }
  }
}

// fix for chrome bug, see https://github.com/github/github/issues/53931
.form-group label {
  position: static;
}
